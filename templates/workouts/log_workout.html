{% extends 'base.html' %}
{% block title %}Log Workout{% endblock %}
{% block content %}
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #fff;
        color: #000;
        padding: 20px;
    }

    .container {
        max-width: 1000px;
        margin: 0 auto;
    }

    h1, h2 {
        font-weight: 600;
        margin-bottom: 20px;
        color: #000;
    }

    h1 {
        font-size: 2rem;
    }

    h2 {
        font-size: 1.5rem;
    }

    .add-exercise-section,
    .workout-section {
        background-color: #f9f9f9;
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 30px;
        border: 1px solid #ccc;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        transition: all 0.2s ease;
    }

    .form-row {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 15px;
        margin-bottom: 20px;
    }

    .sets-container {
        margin-top: 20px;
    }

    .set-inputs {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }

    .set-group {
        background-color: #e6e6e6;
        border-radius: 6px;
        padding: 15px;
        border: 1px solid #ccc;
    }

    .set-title {
        font-size: 0.9rem;
        font-weight: 600;
        margin-bottom: 10px;
        color: #00c851;
    }

    .set-row {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .set-input {
        background-color: #fff;
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 8px 12px;
        color: #000;
        font-size: 0.9rem;
        transition: all 0.2s ease;
    }

    .set-input:focus {
        outline: none;
        border-color: #00c851;
    }

    .form-group {
        display: flex;
        flex-direction: column;
    }

    label {
        font-size: 0.9rem;
        font-weight: 500;
        margin-bottom: 8px;
        color: #000;
    }

    input[type="text"],
    input[type="number"],
    select {
        background-color: #fff;
        border: 1px solid #ccc;
        border-radius: 6px;
        padding: 12px 16px;
        color: #000;
        font-size: 1rem;
        transition: border-color 0.2s ease;
    }

    input[type="text"]:focus,
    input[type="number"]:focus,
    select:focus {
        outline: none;
        border-color: #00c851;
    }

    select {
        cursor: pointer;
    }

    select option {
        background-color: #fff;
        color: #000;
    }

    input::placeholder {
        color: #888;
    }

    .add-btn {
        background-color: #00c851;
        color: #fff;
        border: none;
        border-radius: 6px;
        padding: 12px 24px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: background-color 0.2s ease;
    }

    .add-btn:hover {
        background-color: #009e3c;
    }

    .add-btn:active {
        transform: translateY(1px);
    }

    .workout-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    .workout-table th {
        background-color: #eaeaea;
        color: #000;
        padding: 15px;
        text-align: left;
        font-weight: 600;
        font-size: 0.9rem;
        border-bottom: 1px solid #ccc;
    }

    .workout-table td {
        padding: 15px;
        border-bottom: 1px solid #e0e0e0;
        font-size: 1rem;
    }

    .workout-table tr:hover {
        background-color: #f0f0f0;
    }

    .empty-state {
        text-align: center;
        color: #888;
        font-size: 1.1rem;
        padding: 60px 20px;
    }

    .delete-btn {
        background-color: #ff4444;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 6px 12px;
        font-size: 0.85rem;
        cursor: pointer;
        transition: background-color 0.2s ease;
    }

    .delete-btn:hover {
        background-color: #cc3333;
    }

    .plus-icon {
        font-weight: bold;
        font-size: 1.2rem;
    }

    .messages {
        margin-bottom: 20px;
    }

    .alert {
        padding: 12px;
        border-radius: 6px;
        margin-bottom: 10px;
    }

    .alert-success {
        background-color: #dff5e1;
        color: #00c851;
        border: 1px solid #00c851;
    }

    .alert-error {
        background-color: #ffe5e5;
        color: #ff4444;
        border: 1px solid #ff4444;
    }

    @media (max-width: 768px) {
        .form-row {
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .workout-table {
            font-size: 0.9rem;
        }

        .workout-table th,
        .workout-table td {
            padding: 10px 8px;
        }
    }
</style>

<div class="container">
    <h1>Log a Workout</h1>

    {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <form method="post">
        {% csrf_token %}
        <div class="add-exercise-section">
            <h2>Add Exercise</h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="exercise_name">Exercise Name</label>
                    <input type="text" name="exercise_name" id="exerciseName" placeholder="e.g., Bench Press" required>
                </div>
                <div class="form-group">
                    <label for="sets_count">Number of Sets</label>
                    <select name="sets_count" id="setsCount" onchange="generateSetInputs()" required>
                        <option value="">Select sets</option>
                        {% for i in range %}
                            <option value="{{ i }}">{{ i }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="sets-container" id="setsContainer" style="display: none;">
                <div id="setInputs" class="set-inputs"></div>
            </div>

            <button type="submit" name="add_exercise" class="add-btn">
                <span class="plus-icon">⊕</span>
                Add to Workout
            </button>
        </div>
    </form>

    <div class="workout-section">
        <h2>Today's Workout</h2>
        {% if exercises %}
            <table class="workout-table">
                <thead>
                    <tr>
                        <th>Exercise</th>
                        <th>Set Details</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for exercise in exercises %}
                        <tr>
                            <td>{{ exercise.name }}</td>
                            <td>
                                {% for set in exercise.sets.all %}
                                    Set {{ set.set_number }}: {{ set.reps }} reps × {{ set.weight }}kg
                                    {% if not forloop.last %}<br>{% endif %}
                                {% endfor %}
                            </td>
                            <td>
                                <form method="post" style="display: inline;">
                                    {% csrf_token %}
                                    <input type="hidden" name="exercise_id" value="{{ exercise.id }}">
                                    <button type="submit" name="delete_exercise" class="delete-btn"
                                            onclick="return confirm('Are you sure you want to delete this exercise?')">
                                        Delete
                                    </button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <div class="empty-state">
                No exercises added yet.
            </div>
        {% endif %}
    </div>
</div>

<script>
    function generateSetInputs() {
        const setsCount = document.getElementById('setsCount').value;
        const setsContainer = document.getElementById('setsContainer');
        const setInputs = document.getElementById('setInputs');

        if (!setsCount || setsCount < 1) {
            setsContainer.style.display = 'none';
            return;
        }

        fetch(`{% url 'get_set_inputs' %}?sets_count=${setsCount}`)
            .then(response => response.json())
            .then(data => {
                if (data.html) {
                    setsContainer.style.display = 'block';
                    setInputs.innerHTML = data.html;
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }
</script>
{% endblock %}
